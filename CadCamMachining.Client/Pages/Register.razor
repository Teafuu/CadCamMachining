@page "/register"
@layout LoginLayout
@inject NavigationManager navigationManager
@inject IdentityAuthenticationStateProvider authStateProvider

<PageTitle>Register</PageTitle>

<MudThemeProvider IsDarkMode="true" />

<PageTitle>Login</PageTitle>

<MudText Typo="Typo.h2" Align="Align.Center" Class="d-flex justify-center ma-20">Cad Cam Machining</MudText>
<EditForm OnValidSubmit="OnSubmit" Model="@registerParameters">
    <DataAnnotationsValidator />
    <MudGrid Class="d-flex justify-center">
        <MudItem xs="12" sm="7">
            <MudCard>
                <MudCardContent>
                    <MudTextField Label="Email" Class="mt-3"
                                  @bind-Value="registerParameters.UserName" For="@(() => registerParameters.UserName)" />
                    <MudTextField Label="Password" HelperText="Choose a strong password" Class="mt-3"
                                  @bind-Value="registerParameters.Password" For="@(() => registerParameters.Password)" InputType="InputType.Password" />
                    <MudTextField Label="Password" HelperText="Confirm your password" Class="mt-3"
                                  @bind-Value="registerParameters.PasswordConfirm" For="@(() => registerParameters.PasswordConfirm)" InputType="InputType.Password" />
                    <MudText Color="Color.Error">@error</MudText>
                </MudCardContent>
                <MudPaper Class="align-center pa-4 mt-4">
                    <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto">Register</MudButton>
                </MudPaper>
            </MudCard>
        </MudItem>
    </MudGrid>
</EditForm>

@code {

    RegisterParameters registerParameters { get; set; } = new RegisterParameters();
    string error { get; set; }

    async Task OnSubmit()
    {
        error = null;
        try
        {
            await authStateProvider.Register(registerParameters);
            navigationManager.NavigateTo("");
        }
        catch (Exception ex)
        {
            error = ex.Message;
        }
    }
}