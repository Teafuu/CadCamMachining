@page "/login"
@layout LoginLayout
@inject NavigationManager navigationManager
@inject IdentityAuthenticationStateProvider authStateProvider
<MudThemeProvider IsDarkMode="true" />

<PageTitle>Login</PageTitle>



<EditForm OnValidSubmit="OnSubmit" Model="@loginParameters">
    <DataAnnotationsValidator />
    <MudGrid>
        <MudItem xs="12" sm="7">
            <MudCard>
                <MudCardContent>
                    <MudTextField Label="Email" Class="mt-3"
                                  @bind-Value="loginParameters.UserName" For="@(() => loginParameters.UserName)"/>
                    <MudTextField Label="Password" HelperText="Choose a strong password" Class="mt-3"
                                  @bind-Value="loginParameters.Password" For="@(() => loginParameters.Password)" InputType="InputType.Password"/>
                    <MudText Color="Color.Error">@error</MudText>
                </MudCardContent>
                    <MudPaper Class="align-center pa-4 mt-4">
                    <MudButton ButtonType="ButtonType.Button" Variant="Variant.Filled" Color="Color.Default" OnClick="NavigateToRegisterPage" Class="ml-auto">Register</MudButton>
                    <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto">Login</MudButton>
                </MudPaper>
            </MudCard>
        </MudItem>
    </MudGrid>
</EditForm>

@code {
    LoginParameters loginParameters { get; set; } = new LoginParameters();
    string error { get; set; }

    async Task OnSubmit()
    {
        error = null;
        try
        {
            await authStateProvider.Login(loginParameters);
            navigationManager.NavigateTo("");
        }
        catch (Exception ex)
        {
            error = ex.Message;
        }
    }

    async Task NavigateToRegisterPage()
    {
        navigationManager.NavigateTo("register");

    }
}