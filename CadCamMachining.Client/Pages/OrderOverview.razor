@page "/OrderOverview"
@using CadCamMachining.Shared.Models
@using MudBlazor
@inject IDialogService DialogService
@inject OrderFacade OrderFacade

<MudLayout>
    <MudButton OnClick="@OpenDialogAsync" Class="align-end" Size="@Size.Small" Variant="@Variant.Filled" Color="@Color.Primary">Add</MudButton>
    <OrderList Orders="_orders"/>
</MudLayout>

@code 
{
    private ICollection<OrderDto> _orders = new List<OrderDto>();

    protected override async Task OnInitializedAsync()
    {
        var orders = await OrderFacade.GetOrdersAsync();
        _orders = orders;

        OrderFacade.OrdersUpdated += HandleOrdersUpdates;
    }


    private Task OpenDialogAsync()
    {
        var options = new DialogOptions { CloseOnEscapeKey = true };

        return DialogService.ShowAsync<OrderCreateDialog>("Simple Dialog", options);
    }

    private void HandleOrdersUpdates(object sender, ICollection<OrderDto> orders)
    {
        _orders = orders;
        StateHasChanged();
    }

    public void Dispose()
    {
        OrderFacade.OrdersUpdated -= HandleOrdersUpdates;
    }
}